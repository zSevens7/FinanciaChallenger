<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correção do Erro 502 - Backend</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .console {
            background-color: #1a202c;
            color: #68d391;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        .file-tree {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
        }
        .solution-card {
            transition: all 0.3s ease;
        }
        .solution-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8 px-4">
    <div class="max-w-5xl mx-auto">
        <!-- Cabeçalho -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Correção do Erro 502 - Backend</h1>
            <p class="text-gray-600">Problema: Cannot find package 'express'</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Painel de Diagnóstico -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-bug text-red-500 mr-2"></i>Diagnóstico do Problema
                </h2>
                
                <div class="mb-6">
                    <h3 class="font-medium text-gray-800 mb-2">Log de Erro</h3>
                    <div class="console">
    Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'express' 
    imported from /root/financia_backend/backend/src/server.js
        at new NodeError (node:internal/errors:405:5)
        at packageResolve (node:internal/modules/esm/resolve:916:9)
        at moduleResolve (node:internal/modules/esm/resolve:973:20)
        at defaultResolve (node:internal/modules/esm/resolve:1193:11)
        at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:403:12)
        at ModuleLoader.resolve (node:internal/modules/esm/loader:372:25)
        at ModuleLoader.getModuleJob (node:internal/modules/esm/loader:249:38)
        at ModuleWrap.<anonymous> (node:internal/modules/esm/module_job:76:39)
        at link (node:internal/modules/esm/module_job:75:36) {
    code: 'ERR_MODULE_NOT_FOUND'
    }
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-medium text-gray-800 mb-2">Estrutura de Arquivos</h3>
                    <div class="file-tree">
    financia_backend/
    ├── backend/
    │   ├── src/
    │   │   ├── server.js
    │   │   ├── routes/
    │   │   │   └── auth.js
    │   │   └── middleware/
    │   │       └── authMiddleware.js
    │   └── package.json
    └── .env
                    </div>
                </div>
                
                <div>
                    <h3 class="font-medium text-gray-800 mb-2">Causa do Problema</h3>
                    <ul class="list-disc list-inside text-gray-600 space-y-2">
                        <li>Pacotes Node.js não instalados (express, bcrypt, jsonwebtoken, mysql2, etc.)</li>
                        <li>Problema de permissões na instalação</li>
                        <li>PM2 executando a partir do diretório incorreto</li>
                        <li>Problema com módulos ES6 (import/export)</li>
                    </ul>
                </div>
            </div>

            <!-- Painel de Soluções -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-tools text-blue-500 mr-2"></i>Soluções
                </h2>
                
                <div class="space-y-5">
                    <div class="solution-card bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h3 class="font-medium text-gray-800 mb-2">1. Instalar Dependências</h3>
                        <p class="text-gray-600 text-sm mb-3">Execute no diretório do projeto:</p>
                        <div class="console text-sm mb-2">
    cd /root/financia_backend/backend
    npm install
                        </div>
                        <button class="copy-btn bg-blue-600 hover:bg-blue-700 text-white text-xs py-1 px-3 rounded">
                            <i class="fas fa-copy mr-1"></i>Copiar Comando
                        </button>
                    </div>
                    
                    <div class="solution-card bg-green-50 p-4 rounded-lg border border-green-200">
                        <h3 class="font-medium text-gray-800 mb-2">2. Verificar Package.json</h3>
                        <p class="text-gray-600 text-sm mb-2">Certifique-se de que o package.json contém:</p>
                        <div class="console text-xs">
    {
      "dependencies": {
        "express": "^4.18.2",
        "bcrypt": "^5.1.0",
        "jsonwebtoken": "^9.0.0",
        "mysql2": "^3.2.0",
        "dotenv": "^16.0.3"
      },
      "type": "module"
    }
                        </div>
                    </div>
                    
                    <div class="solution-card bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <h3 class="font-medium text-gray-800 mb-2">3. Reiniciar PM2</h3>
                        <p class="text-gray-600 text-sm mb-3">Pare e inicie novamente a aplicação:</p>
                        <div class="console text-sm mb-2">
    pm2 stop financa-backend
    pm2 start server.js --name financa-backend
                        </div>
                        <button class="copy-btn bg-yellow-600 hover:bg-yellow-700 text-white text-xs py-1 px-3 rounded">
                            <i class="fas fa-copy mr-1"></i>Copiar Comando
                        </button>
                    </div>
                    
                    <div class="solution-card bg-purple-50 p-4 rounded-lg border border-purple-200">
                        <h3 class="font-medium text-gray-800 mb-2">4. Verificar Variáveis de Ambiente</h3>
                        <p class="text-gray-600 text-sm mb-3">Certifique-se de que o arquivo .env contém:</p>
                        <div class="console text-xs">
    DB_HOST=localhost
    DB_USER=seu_usuario
    DB_PASSWORD=sua_senha
    DB_NAME=seu_banco
    JWT_SECRET=seu_jwt_secret
    PORT=4000
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Código Corrigido -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-code text-green-500 mr-2"></i>Código Corrigido - auth.js
            </h2>
            
            <p class="text-gray-600 mb-4">Substitua o trecho problemático com <code>require('crypto')</code> por:</p>
            
            <div class="console text-sm">
// No início do arquivo, adicione:
import crypto from 'crypto';

// E depois substitua a linha:
// const crypto = require('crypto');
// por:
// já importado acima
            </div>
        </div>

        <!-- Testar Solução -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-check-circle text-green-500 mr-2"></i>Testar a Solução
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-100 p-4 rounded-lg">
                    <h3 class="font-medium text-gray-800 mb-2">Verificar Instalação</h3>
                    <div class="console text-xs">
    npm list express bcrypt jsonwebtoken mysql2
                    </div>
                    <button class="copy-btn bg-gray-700 hover:bg-gray-800 text-white text-xs py-1 px-3 rounded mt-2">
                        <i class="fas fa-copy mr-1"></i>Copiar Comando
                    </button>
                </div>
                
                <div class="bg-gray-100 p-4 rounded-lg">
                    <h3 class="font-medium text-gray-800 mb-2">Testar Servidor</h3>
                    <div class="console text-xs">
    node src/server.js
                    </div>
                    <button class="copy-btn bg-gray-700 hover:bg-gray-800 text-white text-xs py-1 px-3 rounded mt-2">
                        <i class="fas fa-copy mr-1"></i>Copiar Comando
                    </button>
                </div>
            </div>
            
            <div class="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-blue-400"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-blue-700">
                            Após aplicar as correções, verifique se o erro 502 foi resolvido testando a rota de recuperação de senha.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Funcionalidade de copiar comandos
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const command = this.parentElement.querySelector('.console').textContent.trim();
                    navigator.clipboard.writeText(command).then(() => {
                        const originalText = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check mr-1"></i>Copiado!';
                        setTimeout(() => {
                            this.innerHTML = originalText;
                        }, 2000);
                    });
                });
            });
        });
    </script>
</body>
</html>